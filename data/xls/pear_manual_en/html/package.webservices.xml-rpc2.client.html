<HTML
><HEAD
><TITLE
>Client Side</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.76b+
"><LINK
REL="HOME"
TITLE="PEAR Manual"
HREF="index.html"><LINK
REL="UP"
TITLE="XML_RPC2"
HREF="package.webservices.xml-rpc2.html"><LINK
REL="PREVIOUS"
TITLE="Introduction"
HREF="package.webservices.xml-rpc2.intro.html"><LINK
REL="NEXT"
TITLE="Server Side"
HREF="package.webservices.xml-rpc2.server.html"><META
HTTP-EQUIV="Content-type"
CONTENT="text/html; charset=ISO-8859-1"></HEAD
><BODY
CLASS="refentry"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>PEAR Manual</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="package.webservices.xml-rpc2.intro.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="package.webservices.xml-rpc2.server.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><H1
><A
NAME="package.webservices.xml-rpc2.client">Client Side</H1
><DIV
CLASS="refnamediv"
><A
NAME="AEN102006"
></A
>Client Side&nbsp;--&nbsp;</DIV
><DIV
CLASS="refsect1"
><A
NAME="package.webservices.xml-rpc2.client.intro"
></A
><H2
>Introduction about the XML_RPC2 client side usage</H2
><P
>&#13;   Thanks to PHP5, it's really easy to do XMLRPC client requests with
   XML_RPC2. The usage is really straightforward.
  </P
><P
>&#13;   First, you include 'XML/RPC2/Client.php' file (only this one).
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>require_once 'XML/RPC2/Client.php';</PRE
></TD
></TR
></TABLE
>
  </P
><P
>&#13;   Second, you make an assocative arrays of options to tune XML_RPC2 (prefix,
   proxy, manual backend choice...).
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>$options = array(
    'prefix' =&#62; 'package.'
);</PRE
></TD
></TR
></TABLE
>
  </P
><P
>&#13;   Third, you make a XML_RPC2_Client object with the server URL and the with
   the options array.
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>$client = XML_RPC2_Client::create('http://pear.php.net/xmlrpc.php', $options);</PRE
></TD
></TR
></TABLE
>
  </P
><P
>&#13;   Then, you send your request by calling the server method as it was a local
   method of the $client object.
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>$result = $client-&#62;info('XML_RPC2');</PRE
></TD
></TR
></TABLE
>
   This single line will encode a XMLRPC client request for the package.info() (prefix + method name)
   method with a single argument (the string 'XML_RPC2'), will send the request over HTTP to the
   server and will decode the response into PHP native types. With a single line !
  </P
><P
>&#13;   Of course, to catch server errors, you have to add a few lines around you client call like for example :
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>try {
    $result = $client-&#62;info('XML_RPC2'); 
    print_r($result);
} catch (XML_RPC2_FaultException $e) {
    // The XMLRPC server returns a XMLRPC error
    die('Exception #' . $result-&#62;getFaultCode() . ' : ' . $e-&#62;getFaultString());
} catch (Exception $e) {  
    // Other errors (HTTP or networking problems...)
    die('Exception : ' . $e-&#62;getFaultString());
}</PRE
></TD
></TR
></TABLE
>
  </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="package.webservices.xml-rpc2.client.options"
></A
><H2
>The options array</H2
><P
>&#13;   This array is completely optional but really usefull. The following keys
   are available :
   <DIV
CLASS="table"
><A
NAME="AEN102025"><P
><B
>Table 60-1. Options available keys</B
></P
><TABLE
BORDER="1"
CLASS="CALSTABLE"
><THEAD
><TR
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Option</TH
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Data Type</TH
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Default Value</TH
><TH
ALIGN="LEFT"
VALIGN="MIDDLE"
>Description</TH
></TR
></THEAD
><TBODY
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>prefix</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>string</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>''</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Prefix added before XMLRPC called method name</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>proxy</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>string</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>''</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Proxy used for the HTTP request (default : no proxy)</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>debug</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>boolean</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
><TT
CLASS="constant"
><B
>FALSE</B
></TT
></TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Debug mode ?</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>encoding</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>string</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>''</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>Encoding of the request 'utf-8', 'iso-8859-1' (for now, only these two ones are officialy supported)</TD
></TR
><TR
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>uglyStructHack</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>boolean</TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
><TT
CLASS="constant"
><B
>TRUE</B
></TT
></TD
><TD
ALIGN="LEFT"
VALIGN="MIDDLE"
>ugly hack to circumvent a XMLRPCEXT bug/feature , see
        <A
HREF="http://bugs.php.net/bug.php?id=21949"
TARGET="_top"
>this PHP bug</A
>
        for more details. The only (reasonable) counterpart of this hack is 
        that you can't use structs with a key beginning with the string 
        'xml_rpc2_ugly_struct_hack_' as arguments of the called method.
       </TD
></TR
></TBODY
></TABLE
></DIV
> 
  </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="package.webservices.xml-rpc2.client.create"
></A
><H2
>Making the XML_RPC2_Client object</H2
><P
>&#13;   It's really easy to make the XML_RPC2_Client object. Use the following syntax :
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>// $XMLRPCServerURL is a string : 'http://pear.php.net/xmlrpc.php' (for example)
// $options is an optional array : see previous section for more informations
$client = XML_RPC2_Client::create($XMLRPCServerURL, $options);</PRE
></TD
></TR
></TABLE
>
   Don't try to call the XML_RPC2_Client constructor directly, use the call() static method.
  </P
></DIV
><DIV
CLASS="refsect1"
><A
NAME="package.webservices.xml-rpc2.client.call"
></A
><H2
>Call the XMLRPC exported method</H2
><P
>&#13;   When the XML_RPC2_Client object is created, you can directly call the remote method as
   it was local. For example :
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>// We call the remote foo() method without any arguments
$result1 = $client-&#62;foo();

// We call the remote bar() method with two arguments (an integer : 123, a string : 'foo')
$result2 = $client-&#62;bar(123, 'foo');

// We call the remote foobar() method with complex data types (2 integer, a string, a structure)
$result3 = $client-&#62;foobar(1, 2, 'foo', array('foo' =&#62; 1, 'bar' =&#62; 2));</PRE
></TD
></TR
></TABLE
>
  </P
><P
>&#13;   Be carefull, XMLRPC spec allows some remote method names with some special characters like "." or "/"... which are
   not available as PHP method names. To deal with them, you have to fix a prefix in a the options array. For example :
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>$options = array('prefix' =&#62; 'foo.');
$client = XML_RPC2_Client::create('http://...', $options);

// We call the foo.bar() method because of the prefix 'foo.' fixed in $options array
$result = $client-&#62;bar();</PRE
></TD
></TR
></TABLE
>
  </P
><P
>&#13;   In most cases, XML_RPC2 transforms automatically PHP native types into XMLRPC 
   types (as described in the SPEC) for the request. In most cases too, XML_RPC2
   transforms the XML server response into PHP native types too. Yet, there are
   two exceptions : 'dateTime.iso8601' and 'base64' which doesn't really exist in PHP.
  </P
><P
>&#13;   To manipulate explicitely these two types, you have to use special objects. Let's see a
   complete example :
   <TABLE
WIDTH="100%"
CELLSPACING="0"
CELLPADDING="0"
BORDER="0"
BGCOLOR="#EEEEEE"
><TR
><TD
><PRE
CLASS="php"
>&#60;?php

// Classic usage
require_once 'XML/RPC2/Client.php';

// To manipulate these types, we need to include this file too
require_once 'XML/RPC2/Value.php';

// To get a 'dateTime.iso8601' object, you have first to set a string with an iso8601 encoded date :
$tmp = "20060116T19:14:03";

// Then, you call this static method to get your 'dateTime.iso8601' object
$time = XML_RPC2_Value::createFromNative($tmp, 'datetime');

// For 'base64', you call the same static method with your string to get a 'base64' object
$base64 = XML_RPC2_Value::createFromNative('foobar', 'base64');

// Then, you can use XML_RPC2_Client as usal :
$options = array('prefix' =&#62; 'validator1.');
$client = XML_RPC2_Client::create('http://phpxmlrpc.sourceforge.net/server.php', $options);
$result = $client-&#62;manyTypesTest(1, true, 'foo', 3.14159, $time, $base64);

// The remote validator1.manyTypesTest() method returns an array with the 6 given arguments
$result_datetime = $result[4]; // a 'dateTime.iso8601' object
$result_base64 = $result[5];   // a 'base64' object

// To transform these objects into PHP native types, you have to use public properties of
// these objects as follow :
var_dump($result_datetime-&#62;scalar);      // will return string(17) "20060116T19:14:03"
var_dump($result_datetime-&#62;xmlrpc_type); // will return string(8) "datetime"
var_dump($result_datetime-&#62;timestamp);   // will return int(1137435243)
var_dump($result_base64-&#62;scalar);        // will return string(6) "foobar"
var_dump($result_base64-&#62;xmlrpc_type);   // will return string(6) "base64"

?&#62;</PRE
></TD
></TR
></TABLE
>
  </P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="package.webservices.xml-rpc2.intro.html"
ACCESSKEY="P"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="index.html"
ACCESSKEY="H"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="package.webservices.xml-rpc2.server.html"
ACCESSKEY="N"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Introduction</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="package.webservices.xml-rpc2.html"
ACCESSKEY="U"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Server Side</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>